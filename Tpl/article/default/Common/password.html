<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
 
<title><if condition="!empty($web_title)">{$web_title}-</if>{$glo.web_name}</title>
<meta name="keywords" content="{$glo.web_keywords}" />
<meta name="description" content="{$glo.web_descript}" />
  <script type="text/javascript">document.documentElement.style.fontSize = document.documentElement.clientWidth / 750*100 + 'px';</script>
	</head>

	<script type="text/javascript" src="/Public/wap/js/jquery-1.11.3.min.js"></script>
 

<body >
<style>
    body, div, dl, dt, dd, ul, ol, li, h1, h2, h3, h4, h5, h6, pre, code, form, fieldset, legend, input, textarea, p, blockquote, th, td, header, hgroup, nav, section, article, aside, footer, figure, figcaption, menu, button { margin: 0; padding: 0; }
    h1, h2, h3, h4, h5, h6 {font-size:inherit;font-weight: normal;}
    table {border-collapse: collapse;border-spacing: 0;}
    fieldset,img { border: 0; }
    li {list-style: none;}
    input,textarea,select {font-family:inherit;font-size:inherit; font-weight:inherit;}
    button,input[type="text"]{border: none; background: none;-webkit-appearance:none;outline:none;font-size: .32rem}
    button,input{border: none; background: none;-webkit-appearance:none;outline:none;font-size: .32rem}
    a { -webkit-touch-callout:none;text-decoration: none;color: #0079ff; outline:none;}
    em,i {font-style: normal;}
    ::-webkit-input-placeholder {color:#999;}
    body{ width:7.5rem;background:#f7f7f7 url("/Public/zpublic/img/log.png")no-repeat;background-size:100%;}
    .all{width: 5.9rem;margin:  5rem 0.4rem .28rem ;height:8rem;border-radius: .1rem;background: #ffffff;padding: .4rem}
    .l-loginform{border-bottom: .01rem #d2d2d2 solid ;overflow: auto;padding-top: .3rem;padding-bottom: .3rem}
    .l-loginform>span{height: .43rem;float: left;margin: 0;}

    .l-loginform>span.aaa{margin-top: -.05rem;padding: .05rem 0;float: right;color:#3575ea;width: 1.6rem;height: .43rem;line-height: .43rem;font-size: .26rem;text-align: center;border-radius: .1rem;border: 1px solid;}
    .l-loginform>input.yanzheng{width: 2.22rem}
    .l-loginform>input{height: .43rem;line-height: .43rem;float: left;margin-left: .3rem}
    .l-loginform>span>img{width: .35rem;height: .43rem;float:left;}
    .l-loginbtn{margin-top: 1.1rem;margin-bottom:.3rem;width: 5.9rem ;height:.9rem;text-align: center;color:#ffffff;font-size: .36rem; background: linear-gradient(to right, #0976ff , #1ebbff);border-radius: .5rem}
    .clearfix{margin-bottom: 1rem}
    .clearfix>p{width: 5rem;text-align: center;font-size:.25rem;color: #477bff;}
    .clearfix>p>a{color: #477bff;font-size: .3rem;padding: 0 .4rem}
    .dl{font-size: .22rem;color:#737373;text-align: center;letter-spacing: -.035rem;margin-bottom:.4rem}
    .dl span{letter-spacing:.015rem;padding:0 .25rem;background: #ffffff;text-align: center}
    .d2{border-bottom: 1px solid #d2d2d2;margin-top: -.55rem;}
    .mass{margin-left: 2.17rem ;width: .65rem;height: .65rem}
</style>
<body>
<div class="all">
    <form action="__URL__/changepass/" id="myForm" method="post">

        <div class="l-loginform">
            <span><img src="/Public/zpublic/img/shouji.png"></span>
            <input type="text"  name="phone" id="phone" value=""  placeholder="请输入手机号"/>
        </div>
        <div class="l-loginform">
            <span><img src="/Public/zpublic/img/dunpai.png"></span>
            <input class="yanzheng" type="text"  name="Verification" id="Verification" placeholder="请输入验证码"/>
<script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>

<span class="aaa l-yanzhengm" id="TencentCaptcha" data-appid="2024559842"  data-cbfn="callback">获取验证码</span>
 <?php
if(isset($reg_code_time)&&!empty($reg_code_time)){
echo "<script type='text/javascript'>var zz=".$reg_code_time." </script>";
echo "<script type='text/javascript'>var aa=".time()." </script>";
}else{
echo "<script type='text/javascript'>var zz=0 </script>";
echo "<script type='text/javascript'>var aa=60 </script>";
}
?>

        </div>
        <div class="l-loginform">
            <span><img src="/Public/zpublic/img/mima.png"></span>
            <input type="password" name="newpwd1" id="newpwd1" placeholder="请输入新密码"/>

        </div>
        <div class="l-loginform">
            <span><img src="/Public/zpublic/img/mima.png"></span>
            <input  type="password"  name="newpwd2" id="newpwd2" placeholder="请确认新密码"/>

        </div>

        <button style="display: block;border: 0px;"  onclick="submitForm()" type="button" class="l-loginbtn">修改密码</button>
    </form>
</div>


	</body>
</html>
<script src="/Style/file/layer/layer.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/web/js/layer.js"></script>

<script type="text/javascript">

  var vazvcode;
          window.callback = function(res){ 
          res=res; 
          if(res.ret === 0){ 
                     
               $.ajax({

                   type: "POST",

                   url: "/wapmember/Common/curl",

                   data: {ticket:res.ticket, randstr:res.randstr},

                   dataType: "json",
                   success: function(data){ 
                        //   console.log(data);
                                //   $("#TencentCaptcha").val("验证通过");
                                  // $("#TencentCaptcha").css({"color":"#0af934"});
                                 vazvcode=1;
                                 zmembersuser()
                                        //  vazvcodedata=data
                    var dataz= $.parseJSON(data );
                      if(dataz.err_msg=="ok"){
                      //   zmembersuser()
                          // vazvcode=1;      
                      }
                          
                                   
                   }
                                //    console.log(data);
                  
               }); 
            }
          }

    	    


  function submitForm() {
  		var phone = $("#phone").val();
  		var Verification = $("#Verification").val();
  		
		var newspwd1 = $("#newpwd1").val();
		var newspwd2 = $("#newpwd2").val();
if(phone==""){
alert("手机号不能为空")	;
return false;
}
if(newspwd1==""){
alert("密码不能为空")	;
return false;
}
if(newspwd2==""){
alert("确认密码不能为空")	;
return false;
}
if(newspwd2!=newspwd1){
alert("密码不一致")	;
return false;
}
if(Verification==""){
alert("验证码不能为空")	;
return false;
}
   		 $.ajax({
			url: "__URL__/changepass/",
			type: "post",
			dataType: "json",
			data: {"newpwd1":newspwd1,"newpwd2":newspwd2,"Verification":Verification,"phone":phone},
			success: function(d) {
				if (d.status == "2") {
					alert('原密码错误，请重新输入！');
					return;
				} else if (d.status == "1") {
					alert('恭喜，密码修改成功');
					window.location.reload();
				}else if (d.status == "3") {
					alert('验证码不正确');
					window.location.reload();
				}else {
					alert('对不起，原密码与新密码相同或者操作失败，请联系客服！');
				}
			}
		})
     // document.getElementById("myForm").submit();
    
   }


function zmembersuser() { 
    var phone = $("#phone").val(); 
    if(phone == ""){
      layer.msg("手机号不能为空")
      return false;
    }else{
      settime() 
    }
};
  var zc=aa-zz;
  if(zc>=60){
     var countdown=60; 
  }else{
    var countdown=zc; 
  }
//     var countdown=60; 
     function settime() 
        { 
        	
            var phone = $("#phone").val();
    var vcode = $("#vcode").val(); 
      if (countdown == 60)
            {
//          	 alert(phone);return;
    $.ajax({
      url: "/wapmember/common/sendcode/",
      type: "post",
      dataType: "json",
      data: {"phone":phone,"type":2,"vcode":vcode},
      success: function(d) {
        if(d.status == "p"){
        	   countdown = 0; 
            alert(d.info);
             return false;
          }else if(d.status == "m"){
            alert(d.info);
               countdown = 0; 
             return false;
          }
          else if(d.status == "f"){
            alert(d.info);
              countdown = 0; 
             return false;
          }else{
           alert(d.info,{icon: 1});
            return false;
          }
      }
    });
      }
            if (countdown == 0) 
            { 
                $("#TencentCaptcha").removeAttr("disabled");    
                $("#TencentCaptcha").html("获取验证码"); 
                countdown = 60; 
            } 
            else 
            { 
                $("#TencentCaptcha").attr("disabled","disabled");
                $("#TencentCaptcha").html("重新发送(" + countdown + ")"); 
                countdown--; 
            } 
            var dxtimer = setTimeout(function() { if (countdown == 60){clearTimeout(dxtimer);}else{settime();} },1000) 
            }
function strLength(as_str){
    return as_str.replace(/[^\x00-\xff]/g, 'xx').length;
}; 
</script>